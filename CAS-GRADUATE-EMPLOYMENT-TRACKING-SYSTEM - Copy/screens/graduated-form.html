<!-- New Graduated Student Form -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduated Student Form</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Ensure this standalone page shows even if global .screen hides it */
        .screen { display:block !important; }
        .form-header { position:sticky; top:0; z-index:6; display:grid; grid-template-columns:80px 1fr 80px; align-items:center; gap:16px; background:linear-gradient(90deg,#1e3a8a,#2742a2); color:#ffffff; padding:10px 0; box-shadow:0 8px 20px rgba(0,0,0,.08); }
        .form-header img { width:64px; height:64px; object-fit:contain; filter: drop-shadow(0 2px 4px rgba(0,0,0,.25)); }
        .form-title-wrap { text-align:center; }
        .form-uni { font-family:'Times New Roman',serif; font-weight:800; letter-spacing:.5px; font-size:22px; color:#ffffff; }
        .form-sub { font-size:12px; opacity:.95; }
        .form-title { font-size:18px; font-weight:800; margin-top:4px; color:#ffffff; }
        .form-section-bar { background:#1e3a8a; color:#ffffff; border-radius:8px; padding:6px 10px; font-weight:800; }
        .next-button { background:linear-gradient(90deg,#1e3a8a,#0f1f58); border:none; color:#000000; padding:14px 36px; border-radius:999px; font-weight:800; box-shadow:0 12px 30px rgba(30,58,138,.35); }
        .next-button:hover { filter:brightness(1.05); transform: translateY(-1px); }
        /* Success popup styles */
        .success-popup { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; z-index:10000; }
        .success-popup-content { background:white; padding:3rem; border-radius:20px; text-align:center; box-shadow:0 20px 40px rgba(0,0,0,0.3); max-width:500px; }
        .success-icon { font-size:4rem; margin-bottom:1rem; }
        .success-title { color:#1e3a8a; font-size:2rem; margin-bottom:1rem; font-weight:700; }
        .success-message { color:#666; font-size:1.1rem; margin-bottom:1rem; line-height:1.6; }
        .success-button { background:#1e3a8a; color:#fff; border:none; padding:12px 24px; border-radius:6px; font-weight:600; cursor:pointer; }
        .success-button:hover { background:#1e40af; }
        /* Form labels and text styling */
        .form-label { color:#000000; font-weight:600; margin-bottom:8px; display:block; }
        .form-input { color:#000000; background:#ffffff; }
        .form-input::placeholder { color:#6b7280; }
        /* Ensure white, formal background */
        .main-interface { background:#ceb766; }
        .background-container, .dash-yellow-tint { display:none !important; }
        body { background:#000000; }
    </style>
</head>
<div id="graduated-form-screen" class="screen">
    <div class="main-interface">
        <div class="background-container">
            <img class="university-building" alt="University building" src="../background1.jpg" />
        </div>
        <div class="dash-yellow-tint"></div>
        <div class="graduated-form-container">
            <div class="form-header">
                <img src="../logo.png" alt="CAS"/>
                <div class="form-title-wrap">
                    <div class="form-uni">SAMAR STATE UNIVERSITY</div>
                    <div class="form-sub">Arche Blvd, Catbalogan City, 6700 â€¢ ssu.edu.ph</div>
                    <div class="form-title"><i class="fa-solid fa-graduation-cap" aria-hidden="true"></i> Graduate Employment Tracking Form</div>
                </div>
                <img src="../ssulogo.png" alt="SSU"/>
            </div>
            <div class="form-section">
                <div class="form-section-bar"><span>A. PERSONAL INFORMATION</span></div>
                <div class="form-grid form-grid-2">
                    <div class="form-col">
                        <label class="form-label" for="gf-name">Full Name<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-name" name="full_name" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-student-id">Student ID<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-student-id" name="student_id" aria-required="true" placeholder="e.g., 2021-12345" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-email">Email Address<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-email" name="email" type="email" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-phone">Contact Number<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-phone" name="phone" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-address">Current Address<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-address" name="address" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-birthdate">Birth Date<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-birthdate" name="birth_date" type="date" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-age">Age<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-age" name="age" type="number" min="16" max="100" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-picture">Profile Picture<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-picture" name="picture" type="file" accept="image/*" aria-required="true" onchange="previewImageGraduated(this)" />
                        <div id="picture-preview-graduated" style="margin-top: 10px; display: none;">
                            <img id="preview-img-graduated" style="max-width: 150px; max-height: 150px; border-radius: 8px; border: 2px solid #ddd;" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-section">
                <div class="form-section-bar"><span>B. ACADEMIC INFORMATION</span></div>
                <div class="form-grid form-grid-2">
                    <div class="form-col">
                        <label class="form-label" for="gf-program">Program Graduated<span aria-hidden="true">*</span></label>
                        <select class="form-input" id="gf-program" name="program" aria-required="true">
                            <option value="">Select Program</option>
                            <option value="BSIS">Bachelor of Science in Information System (BSIS)</option>
                            <option value="BSIT">Bachelor of Science in Information Technology (BSIT)</option>
                            <option value="BSS">Bachelor of Science in Statistics (BSS)</option>
                            <option value="BSPSYCH">Bachelor of Science in Psychology (BSPSYCH)</option>
                        </select>

                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-graduation-year">Year Graduated<span aria-hidden="true">*</span></label>
                        <input class="form-input" id="gf-graduation-year" name="graduation_year" type="number" min="1900" max="2030" placeholder="e.g., 2023" aria-required="true" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-gpa">Final GPA</label>
                        <input class="form-input" id="gf-gpa" name="gpa" type="number" step="0.01" min="1.0" max="4.0" placeholder="e.g., 3.25" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-thesis">Thesis/Capstone Title</label>
                        <input class="form-input" id="gf-thesis" name="thesis_title" placeholder="Enter your thesis or capstone title" />
                    </div>
                </div>
            </div>
            <div class="form-section">
                <div class="form-section-bar"><span>C. EMPLOYMENT INFORMATION</span></div>
                <div class="form-grid form-grid-2">
                    <div class="form-col">
                        <label class="form-label">Current Employment Status<span aria-hidden="true">*</span></label>
                        <div class="form-choice-row">
                            <label class="choice"><input type="radio" name="employment_status" value="employed" required/> Employed</label>
                            <label class="choice"><input type="radio" name="employment_status" value="unemployed" required/> Unemployed</label>
                            <label class="choice"><input type="radio" name="employment_status" value="self-employed" required/> Self-employed</label>
                            <label class="choice"><input type="radio" name="employment_status" value="further-studies" required/> Pursuing further studies</label>
                        </div>
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-job-title">Current Job Title</label>
                        <input class="form-input" id="gf-job-title" name="job_title" placeholder="e.g., Software Developer, Data Analyst" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-company">Company/Organization Name</label>
                        <input class="form-input" id="gf-company" name="company_name" placeholder="Name of your current employer" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-industry">Industry/Sector</label>
                        <input class="form-input" id="gf-industry" name="industry" placeholder="e.g., Information Technology, Healthcare" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-start-date">Employment Start Date</label>
                        <input class="form-input" id="gf-start-date" name="start_date" type="date" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-salary">Monthly Salary Range</label>
                        <select class="form-input" id="gf-salary" name="salary_range">
                            <option value="">Select Salary Range</option>
                            <option value="below-10k">Below 10,000 PHP</option>
                            <option value="10k-20k">10,000 - 20,000 PHP</option>
                            <option value="20k-30k">20,000 - 30,000 PHP</option>
                            <option value="30k-50k">30,000 - 50,000 PHP</option>
                            <option value="above-50k">Above 50,000 PHP</option>
                        </select>
                    </div>
                    <div class="form-col form-span-2">
                        <label class="form-label" for="gf-job-description">Job Description/Responsibilities</label>
                        <textarea class="form-input" id="gf-job-description" name="job_description" rows="3" placeholder="Describe your main responsibilities and tasks..."></textarea>
                    </div>
                    <div class="form-col">
                        <label class="form-label">Is your job related to your degree?<span aria-hidden="true">*</span></label>
                        <div class="form-choice-row">
                            <label class="choice"><input type="radio" name="job_related" value="yes" required/> Yes</label>
                            <label class="choice"><input type="radio" name="job_related" value="no" required/> No</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-section">
                <div class="form-section-bar"><span>D. CAREER PROGRESSION</span></div>
                <div class="form-grid form-grid-2">
                    <div class="form-col">
                        <label class="form-label" for="gf-first-job">First Job After Graduation</label>
                        <input class="form-input" id="gf-first-job" name="first_job" placeholder="e.g., Junior Developer" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-first-job-year">Year Started First Job</label>
                        <input class="form-input" id="gf-first-job-year" name="first_job_year" type="number" min="1900" max="2030" placeholder="e.g., 2023" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-promotions">Promotions Received</label>
                        <input class="form-input" id="gf-promotions" name="promotions" placeholder="List any promotions" />
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-career-progress">Career Progression</label>
                        <input class="form-input" id="gf-career-progress" name="career_progress" placeholder="Describe your career progression" />
                    </div>
                    <div class="form-col form-span-2">
                        <label class="form-label" for="gf-career-comments">Additional Comments</label>
                        <textarea class="form-input" id="gf-career-comments" name="career_comments" rows="2" placeholder="Any additional comments..."></textarea>
                    </div>
                </div>
            </div>
            <div class="form-section">
                <div class="form-section-bar"><span>E. UNIVERSITY FEEDBACK</span></div>
                <div class="form-grid form-grid-2">
                    <div class="form-col">
                        <label class="form-label" for="gf-feedback">Feedback on University</label>
                        <textarea class="form-input" id="gf-feedback" name="feedback" rows="2" placeholder="Your feedback..."></textarea>
                    </div>
                    <div class="form-col">
                        <label class="form-label" for="gf-suggestions">Suggestions for Improvement</label>
                        <textarea class="form-input" id="gf-suggestions" name="suggestions" rows="2" placeholder="Your suggestions..."></textarea>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button class="next-button graduated-form-submit" onclick="showSuccessPopup()">SUBMIT</button>
            </div>
        </div>
    </div>
</div>

<!-- Success Popup -->
<div id="success-popup" class="success-popup" style="display: none;">
    <div class="success-popup-content">
        <div class="success-icon">ðŸŽ‰</div>
        <h2 class="success-title">Congratulations!</h2>
        <p class="success-message">
            Your profile has been successfully submitted!<br>
            You can now view your graduated dashboard with all your information.
        </p>
        <button class="success-button" onclick="closeSuccessPopup()">Continue</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // Supabase configuration
  const SUPABASE_URL = "https://mcdkeoomndrwrapcrmch.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1jZGtlb29tbmRyd3JhcGNybWNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxOTM2MDAsImV4cCI6MjA3Mjc2OTYwMH0.QOrm-xmC7x_NVdLnVeo3hEH2MLoZqa5oRG9kjR79F5g";
  
  // Initialize Supabase client
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  
  // Standalone helpers so this page works without the main router (script.js)
  function previewImageGraduated(input){
    const file = input.files && input.files[0];
    if(!file) return;
    const url = URL.createObjectURL(file);
    const img = document.getElementById('preview-img-graduated');
    const wrap = document.getElementById('picture-preview-graduated');
    if(img && wrap){ img.src = url; wrap.style.display='block'; }
  }
  async function showSuccessPopup(){
    try {
      // Collect form data
      const formData = {
        full_name: document.getElementById('gf-name').value,
        contact: document.getElementById('gf-contact').value,
        current_address: document.getElementById('gf-current-address').value,
        age: document.getElementById('gf-age').value,
        email: document.getElementById('gf-email').value,
        program: document.querySelector('input[name="gf-program"]:checked')?.value,
        graduation_year: document.querySelector('input[name="gf-graduation_year"]').value,
        gpa: document.querySelector('input[name="gf-gpa"]').value,
        thesis_title: document.querySelector('input[name="gf-thesis_title"]').value,
        employment_status: document.querySelector('input[name="gf-employment_status"]:checked')?.value,
        job_title: document.getElementById('gf-job-title').value,
        company_name: document.getElementById('gf-company').value,
        industry: document.getElementById('gf-industry').value,
        employment_type: document.querySelector('input[name="gf-employment_type"]:checked')?.value,
        salary_range: document.getElementById('gf-salary').value,
        start_date: document.getElementById('gf-start-date').value,
        location: document.getElementById('gf-location').value,
        job_relevance: document.querySelector('input[name="gf-relevance"]:checked')?.value,
        facebook: document.getElementById('gf-fb').value,
        instagram: document.getElementById('gf-ig').value,
        twitter: document.getElementById('gf-x').value,
        other_social: document.getElementById('gf-other-social').value,
        father_name: document.getElementById('gf-father').value,
        mother_name: document.getElementById('gf-mother').value,
        father_contact: document.getElementById('gf-father-contact').value,
        mother_contact: document.getElementById('gf-mother-contact').value,
        father_occupation: document.getElementById('gf-father-occ').value,
        mother_occupation: document.getElementById('gf-mother-occ').value,
        emergency_name: document.getElementById('gf-em-name').value,
        emergency_email: document.getElementById('gf-em-email').value,
        emergency_relationship: document.querySelector('input[name="gf-em-rel"]:checked')?.value,
        emergency_facebook: document.getElementById('gf-em-fb').value,
        emergency_phone: document.getElementById('gf-em-phone').value,
        emergency_other: document.getElementById('gf-em-other').value,
        suggestions: document.getElementById('gf-suggestions').value,
        user_type: 'graduated',
        verification_status: 'pending',
        created_at: new Date().toISOString()
      };

      // Upload profile picture if selected
      const pictureFile = document.getElementById('gf-picture').files[0];
      let pictureUrl = null;
      if (pictureFile) {
        const fileExt = pictureFile.name.split('.').pop();
        const fileName = `${Date.now()}.${fileExt}`;
        const { data: uploadData, error: uploadError } = await supabase.storage
          .from('profile-pictures')
          .upload(fileName, pictureFile);
        
        if (uploadError) throw uploadError;
        
        const { data: { publicUrl } } = supabase.storage
          .from('profile-pictures')
          .getPublicUrl(fileName);
        pictureUrl = publicUrl;
      }

      // Insert into profiles table
      const { data, error } = await supabase
        .from('profiles')
        .insert([{
          ...formData,
          profile_picture: pictureUrl
        }]);

      if (error) throw error;

      // If employed, also insert employment record
      if (formData.employment_status === 'employed' && formData.job_title && formData.company_name) {
        const { error: empError } = await supabase
          .from('employment_records')
          .insert([{
            profile_id: data[0].id,
            job_title: formData.job_title,
            company_name: formData.company_name,
            industry: formData.industry,
            employment_type: formData.employment_type,
            salary_range: formData.salary_range,
            start_date: formData.start_date,
            location: formData.location,
            job_relevance: formData.job_relevance,
            is_current: true,
            verification_status: 'pending'
          }]);

        if (empError) console.error('Error inserting employment record:', empError);
      }

      // Show success popup
      const popup = document.getElementById('success-popup');
      if(popup) popup.style.display = 'flex';
      
      // After 3 seconds, navigate to dashboard
      setTimeout(() => {
        window.location.href = 'dashboard2.html';
      }, 3000);

    } catch (error) {
      console.error('Error submitting form:', error);
      alert('Error submitting form. Please try again.');
    }
  }
  function closeSuccessPopup(){
    const el = document.getElementById('success-popup');
    if(el) el.style.display = 'none';
  }
</script>
</body>
</html>
